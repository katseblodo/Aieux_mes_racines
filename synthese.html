<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>AÃ¯eux, mes racines - Infographie</title>
    <script src="js/papaparse.min.js"></script>
    <style>
        :root { --dark: #2c3e50; --gold: #d4af37; --blue: #3498db; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        
        /* En-tÃªte Infographie */
        .hero { background: linear-gradient(135deg, var(--dark) 0%, #4b6584 100%); color: white; padding: 40px; border-radius: 15px; text-align: center; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .hero h1 { margin: 0; font-size: 3em; letter-spacing: 2px; }
        .hero p { opacity: 0.8; font-style: italic; }

        /* Grille des Familles */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        
        .family-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-left: 10px solid var(--blue); transition: 0.3s; }
        .family-card:hover { transform: translateY(-5px); }
        .family-card.TT { border-left-color: #e67e22; } /* Tanguy */
        .family-card.QQ { border-left-color: #9b59b6; } 
        .family-card.QP { border-left-color: #2ecc71; }

        .family-name { font-size: 24px; font-weight: bold; color: var(--dark); margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        /* Barrettes de stats */
        .stat-row { margin-bottom: 15px; }
        .stat-label { font-size: 12px; color: #7f8c8d; text-transform: uppercase; font-weight: bold; }
        .stat-value { font-size: 18px; color: var(--dark); }
        
        .progress-bar { background: #eee; height: 8px; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .progress-fill { background: var(--blue); height: 100%; width: 0%; transition: width 1s ease-out; }

        /* Badge Profession */
        .top-job { display: inline-block; background: #fdf1d6; color: #9e7e2a; padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; margin-top: 10px; }

        /* Zone "Records" */
        .records-strip { display: flex; gap: 20px; margin-top: 30px; }
        .record-box { flex: 1; background: white; padding: 20px; border-radius: 12px; text-align: center; border-bottom: 4px solid var(--gold); }
        .record-num { font-size: 32px; font-weight: bold; color: var(--gold); }
    </style>
</head>
<body>

<div id="menu-container"></div>

<div class="container">
    <div class="hero">
        <h1>PANORAMA GÃ‰NÃ‰ALOGIQUE</h1>
        <p>Analyse statistique des racines de Catherine Tanguy</p>
    </div>

    <div class="records-strip" id="global-records">
        <div class="record-box"><div class="record-num" id="total-anc">0</div><div class="stat-label">AncÃªtres identifiÃ©s</div></div>
        <div class="record-box"><div class="record-num" id="total-villes">0</div><div class="stat-label">Villes d'ancrage</div></div>
        <div class="record-box"><div class="record-num" id="age-doyen">0</div><div class="stat-label">Ã‚ge du Doyen</div></div>
    </div>

    <h2 style="margin: 40px 0 20px; color: var(--dark)">ðŸ§­ Portrait des Branches</h2>
    <div class="stats-grid" id="family-stats-container">
        </div>
</div>

<script>
    fetch('menu.html').then(r => r.text()).then(d => document.getElementById('menu-container').innerHTML = d);

    Papa.parse("individus_nettoye.csv", {
        download: true, header: true, delimiter: ";", skipEmptyLines: true,
        complete: function(results) {
            analyserDonnees(results.data);
        }
    });

    function analyserDonnees(data) {
        const stats = {};
        let doyenAge = 0;
        const villesGlobales = new Set();

        data.forEach(p => {
            if(!p.id_famille || p.id_famille === "-") return;
            
            if(!stats[p.id_famille]) {
                stats[p.id_famille] = { count: 0, ages: [], villes: new Set(), jobs: {} };
            }

            const s = stats[p.id_famille];
            s.count++;
            
            // Calcul de l'Ã¢ge
            if(p.date_naissance && p.date_deces) {
                const anN = parseInt(p.date_naissance.substring(p.date_naissance.length - 4));
                const anD = parseInt(p.date_deces.substring(p.date_deces.length - 4));
                if(anN && anD) {
                    const age = anD - anN;
                    if(age > 0 && age < 110) {
                        s.ages.push(age);
                        if(age > doyenAge) doyenAge = age;
                    }
                }
            }

            // MobilitÃ©
            if(p.lieu_naissance) { s.villes.add(p.lieu_naissance); villesGlobales.add(p.lieu_naissance); }
            if(p.lieu_deces) { s.villes.add(p.lieu_deces); villesGlobales.add(p.lieu_deces); }

            // MÃ©tiers
            if(p.profession && p.profession !== "-") {
                s.jobs[p.profession] = (s.jobs[p.profession] || 0) + 1;
            }
        });

        // Affichage records globaux
        document.getElementById('total-anc').innerText = data.length;
        document.getElementById('total-villes').innerText = villesGlobales.size;
        document.getElementById('age-doyen').innerText = doyenAge + " ans";

        const container = document.getElementById('family-stats-container');
        for (let f in stats) {
            const fam = stats[f];
            const ageMoyen = fam.ages.length ? Math.round(fam.ages.reduce((a,b)=>a+b)/fam.ages.length) : "?";
            const topJob = Object.entries(fam.jobs).sort((a,b)=>b[1]-a[1])[0]?.[0] || "Non spÃ©cifiÃ©";
            const mobilite = fam.villes.size;

            container.innerHTML += `
                <div class="family-card ${f}">
                    <div class="family-name">Branche ${f} <span>${fam.count} pers.</span></div>
                    
                    <div class="stat-row">
                        <div class="stat-label">LongÃ©vitÃ© moyenne</div>
                        <div class="stat-value">${ageMoyen} ans</div>
                        <div class="progress-bar"><div class="progress-fill" style="width:${(ageMoyen/90)*100}%"></div></div>
                    </div>

                    <div class="stat-row">
                        <div class="stat-label">MobilitÃ© (Lieux diffÃ©rents)</div>
                        <div class="stat-value">${mobilite} villes</div>
                        <div class="progress-bar"><div class="progress-fill" style="width:${(mobilite/20)*100}%; background:#2ecc71"></div></div>
                    </div>

                    <div class="stat-label">MÃ©tier dominant</div>
                    <div class="top-job">ðŸ›  ${topJob}</div>
                </div>
            `;
        }
    }
</script>
</body>
</html>
